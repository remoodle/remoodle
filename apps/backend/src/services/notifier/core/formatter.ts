import type { GradeChangeDiff, DeadlineReminderDiff } from "./shims";

export const formatCourseDiffs = (data: GradeChangeDiff[]): string => {
  let message = "Updated grades:\n";

  for (const diff of data) {
    message += `\nðŸ“˜ ${diff.course.split(" | ")[0]}:\n`;
    const gradeChanges = diff.grades;
    for (const change of gradeChanges) {
      const [gradeName, previous, updated] = change;
      const displayPrevious = previous === null ? "N/A" : previous;
      const displayUpdated = updated === null ? "N/A" : updated;
      message += `  â€¢ ${gradeName}: <b>${displayPrevious} â†’ ${displayUpdated}</b>\n`;
    }
  }

  return message;
};

export const formatDeadlineReminders = (
  data: DeadlineReminderDiff[],
): string => {
  let message = "ðŸ”” Upcoming deadlines ðŸ””\n\n";

  for (const diff of data) {
    message += `ðŸ—“ ${diff.course}\n`;

    for (const [name, date, remaining, _threshold] of diff.deadlines) {
      const formattedDate = new Date(date).toLocaleString("en-US", {
        weekday: "short",
        month: "short",
        day: "numeric",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false,
        timeZone: "Asia/Almaty",
      });
      message += `  â€¢ ${name}: <b>${remaining}</b>, ${formattedDate}\n`;
    }
    message += "\n";
  }

  return message;
};
